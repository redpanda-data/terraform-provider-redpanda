version: '3'

vars:
  CLI_ARGS: '{{.CLI_ARGS | default ""}}'
  GOLANGCI_LINT: "{{.BUILD_ROOT}}/bin/golangci-lint"

tasks:
  default:
    desc: "Run all code quality checks"
    deps:
      - :tools:install:golangci-lint
    cmds:
      - echo "Running linting..."
      - |
        if [ "$BUILDKITE" = "true" ]; then
          echo "Running in BuildKite environment with buildvcs=false"
          {{.PATH_PREFIX}} GOFLAGS="-buildvcs=false" golangci-lint run --timeout=5m {{.CLI_ARGS}}
        else
          echo "Running in local environment"
          {{.PATH_PREFIX}} golangci-lint run {{.CLI_ARGS}}
        fi
      - echo "Linting completed successfully"

  fix:
    desc: "Run linting with auto-fix"
    cmds:
      - task: default
        vars:
          CLI_ARGS: "--fix"
