version: '3'

vars:
  MOCKS_DIR: "redpanda/mocks"
  MOCKGEN_VERSION: "v0.5.0"
  GOBIN:
    sh: go env GOPATH
  MOCKGEN_CMD: "{{.GOBIN}}/bin/mockgen"

tasks:
  install:mockgen:
    desc: "Install mockgen tool"
    cmds:
      - echo "Installing mockgen {{.MOCKGEN_VERSION}}..."
      - go install go.uber.org/mock/mockgen@{{.MOCKGEN_VERSION}}
      - echo "mockgen installed successfully"
    status:
      - test -f {{.MOCKGEN_CMD}}

  default:
    desc: "Generate and clean mocks (combines clean and generate)"
    deps: [clean, generate]

  clean:
    desc: "Clean generated mocks"
    cmds:
      - echo "Cleaning generated mocks..."
      - rm -f {{.MOCKS_DIR}}/mock_*.go
      - echo "Mocks cleaned successfully"

  generate:
    desc: "Generate all mocks"
    deps: [install:mockgen]
    cmds:
      - echo "Generating mocks..."
      - cd {{.MOCKS_DIR}} && go generate
      - echo "Mocks generated successfully"