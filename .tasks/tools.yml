version: '3'

vars:
  GOBIN:
    sh: go env GOPATH

  # Tool versions
  GOFUMPT_VERSION: "v0.7.0"
  GOLANGCI_LINT_VERSION: "v2.2.1"
  MOCKGEN_VERSION: "v0.5.0"
  TFPLUGINDOCS_VERSION: "latest"

  # Tool paths
  GOFUMPT_CMD: "{{.GOBIN}}/bin/gofumpt"
  GOLANGCI_LINT_CMD: "{{.GOBIN}}/bin/golangci-lint"
  MOCKGEN_CMD: "{{.GOBIN}}/bin/mockgen"
  TFPLUGINDOCS_CMD: "{{.GOBIN}}/bin/tfplugindocs"

tasks:
  install:gofumpt:
    desc: "Install gofumpt formatting tool"
    cmds:
      - echo "Installing gofumpt {{.GOFUMPT_VERSION}}..."
      - go install mvdan.cc/gofumpt@{{.GOFUMPT_VERSION}}
      - echo "gofumpt installed successfully"
    status:
      - test -f {{.GOFUMPT_CMD}}

  install:golangci-lint:
    desc: "Install golangci-lint"
    cmds:
      - echo "Installing golangci-lint {{.GOLANGCI_LINT_VERSION}}..."
      - go install github.com/golangci/golangci-lint/v2/cmd/golangci-lint@{{.GOLANGCI_LINT_VERSION}}
      - echo "golangci-lint installed successfully"
    status:
      - test -f {{.GOLANGCI_LINT_CMD}}

  install:mockgen:
    desc: "Install mockgen tool"
    cmds:
      - echo "Installing mockgen {{.MOCKGEN_VERSION}}..."
      - go install go.uber.org/mock/mockgen@{{.MOCKGEN_VERSION}}
      - echo "mockgen installed successfully"
    status:
      - test -f {{.MOCKGEN_CMD}}

  install:tfplugindocs:
    desc: "Install terraform-plugin-docs tool"
    cmds:
      - echo "Installing tfplugindocs {{.TFPLUGINDOCS_VERSION}}..."
      - go install github.com/hashicorp/terraform-plugin-docs/cmd/tfplugindocs@{{.TFPLUGINDOCS_VERSION}}
      - echo "tfplugindocs installed successfully"
    status:
      - test -f {{.TFPLUGINDOCS_CMD}}

  install:all:
    desc: "Install all development tools"
    deps:
      - install:gofumpt
      - install:golangci-lint
      - install:mockgen
      - install:tfplugindocs
    cmds:
      - echo "All development tools installed successfully"

  check:
    desc: "Check which tools are installed"
    cmds:
      - |
        echo "Checking installed tools..."
        echo ""
        if [ -f "{{.GOFUMPT_CMD}}" ]; then
          echo "✓ gofumpt: {{.GOFUMPT_VERSION}} ({{.GOFUMPT_CMD}})"
        else
          echo "✗ gofumpt: not installed"
        fi
        if [ -f "{{.GOLANGCI_LINT_CMD}}" ]; then
          echo "✓ golangci-lint: {{.GOLANGCI_LINT_VERSION}} ({{.GOLANGCI_LINT_CMD}})"
        else
          echo "✗ golangci-lint: not installed"
        fi
        if [ -f "{{.MOCKGEN_CMD}}" ]; then
          echo "✓ mockgen: {{.MOCKGEN_VERSION}} ({{.MOCKGEN_CMD}})"
        else
          echo "✗ mockgen: not installed"
        fi
        if [ -f "{{.TFPLUGINDOCS_CMD}}" ]; then
          echo "✓ tfplugindocs: {{.TFPLUGINDOCS_VERSION}} ({{.TFPLUGINDOCS_CMD}})"
        else
          echo "✗ tfplugindocs: not installed"
        fi

  default:
    desc: "Show tool installation status"
    cmds:
      - task: check